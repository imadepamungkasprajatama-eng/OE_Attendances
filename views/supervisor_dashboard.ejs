<%- include('partials/header',{user:user, title:'Attendances Dashboard'}) %>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <a href="/" class="btn btn-outline-secondary btn-sm rounded-pill px-3">
      ‚Üê Back to Home
    </a>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="card border-0 mb-4 bg-primary text-white"
        style="border-radius: 1rem; background: linear-gradient(135deg, var(--primary-color) 0%, #3730a3 100%);">
        <div class="card-body p-4 p-md-5">
          <h2 class="fw-bold mb-2">Division Dashboard</h2>
          <p class="mb-0 opacity-75">Overview of attendance for <%= monthLabel %>
          </p>
        </div>
      </div>

      <div class="card border-0 shadow-lg" style="margin-top: -3rem; border-radius: 1rem;">
        <div class="card-body p-4">

          <!-- Controls -->
          <div class="row g-3 align-items-end mb-4">
            <div class="col-md-6">
              <label class="form-label small text-muted fw-bold">Select Division</label>
              <% if (managedDivisions && managedDivisions.length> 1) { %>
                <form method="GET" action="/supervisor">
                  <input type="hidden" name="month" value="<%= monthParam %>">
                  <select name="division" class="form-select" onchange="this.form.submit()">
                    <% managedDivisions.forEach(function(d){ %>
                      <option value="<%= d %>" <%=d===division ? 'selected' : '' %>><%= d %>
                      </option>
                      <% }) %>
                  </select>
                </form>
                <% } else { %>
                  <div class="form-control bg-light">
                    <%= division || '-' %>
                  </div>
                  <% } %>
            </div>
            <div class="col-md-6">
              <form class="row g-2" method="GET" action="/supervisor">
                <input type="hidden" name="division" value="<%= division %>">
                <div class="col-8">
                  <label class="form-label small text-muted fw-bold">Month</label>
                  <input type="month" name="month" class="form-control" value="<%= monthParam %>">
                </div>
                <div class="col-4 d-grid">
                  <button class="btn btn-primary">Refresh</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Table -->
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="bg-light text-muted small text-uppercase">
                <tr>
                  <th class="ps-3 border-0 rounded-start">Name</th>
                  <th class="border-0">Email</th>
                  <th class="border-0">Division</th>
                  <th class="border-0">Total Hours</th>
                  <th class="pe-3 border-0 rounded-end text-end">Report</th>
                </tr>
              </thead>
              <tbody>
                <% if (memberSummaries && memberSummaries.length) { %>
                  <% memberSummaries.forEach(ms=> { %>
                    <tr>
                      <td class="ps-3 fw-medium">
                        <%= ms.user.name %>
                      </td>
                      <td class="text-muted">
                        <%= ms.user.email || '‚Äî' %>
                      </td>
                      <td>
                        <span class="badge bg-soft text-dark border">
                          <%= ms.user.division || '-' %>
                        </span>
                      </td>
                      <td>
                        <span class="d-inline-block px-2 py-1 rounded bg-light fw-bold text-dark">
                          <%= ms.workText %>
                        </span>
                      </td>
                      <td class="text-end pe-3">
                        <form method="GET" action="/supervisor/attendance/export-user-month">
                          <input type="hidden" name="userId" value="<%= ms.user._id %>">
                          <input type="hidden" name="month" value="<%= monthParam %>">
                          <button class="btn btn-sm btn-outline-primary rounded-pill px-3">
                            Download (.xlsx)
                          </button>
                        </form>
                      </td>
                    </tr>
                    <% }) %>
                      <% } else { %>
                        <tr>
                          <td colspan="5" class="text-center py-5 text-muted">
                            <div class="mb-2" style="font-size: 2rem;">üìÇ</div>
                            No members found or no data relative to this month.
                          </td>
                        </tr>
                        <% } %>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
  </div>

  <%- include('partials/footer') %>